#!/bin/bash
#Diseñado por Arturo Martín
#Proyecto Piloto DGA

usuario=${USER}
ejecutor=$(whoami)

#if test "$ejecutor" != "root" ; then
#	exit 1
#fi

echo "Proceso de congelación del Perfil para el usuario $usuario - $ejecutor - $(date)" > /home/$usuario/info-congelacion-perfil.txt

for DIRECTORIO in $(ls /etc/skel-directorios-congelados) ; do
	if test -d /home/$usuario/$DIRECTORIO && test -d /etc/skel-directorios-congelados/$DIRECTORIO ; then
		if rsync --delete -rl /etc/skel-directorios-congelados/$DIRECTORIO /home/$usuario ; then
			echo " --> OK: Se ha sincronizado el directorio $DIRECTORIO del usuario $usuario ..." >> /home/$usuario/info-congelacion-perfil.txt
		else
			echo " --> ERROR: No se ha sincronizado el directorio $DIRECTORIO del usuario $usuario ..." >> /home/$usuario/info-congelacion-perfil.txt
		fi
		chown -R $usuario.sudo /home/$usuario/$DIRECTORIO
	fi
done
